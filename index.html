<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AutoPe√ßas Pro - Pe√ßas para Carros e Caminh√µes</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      margin-bottom: 30px;
      text-align: center;
    }

    h1 {
      color: #667eea;
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #666;
      font-size: 1.2em;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .card h2 {
      color: #667eea;
      margin-bottom: 20px;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
    }

    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    input,
    select,
    textarea {
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1em;
      width: 100%;
      transition: border 0.3s;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      font-weight: bold;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .product-card {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      transition: transform 0.3s;
    }

    .product-card:hover {
      transform: scale(1.05);
    }

    .product-card h3 {
      color: #667eea;
      font-size: 1.1em;
      margin-bottom: 10px;
    }

    .product-card .price {
      font-size: 1.3em;
      color: #28a745;
      font-weight: bold;
      margin: 10px 0;
    }

    .product-card .stock {
      color: #666;
      font-size: 0.9em;
    }

    .chat-container {
      height: 400px;
      display: flex;
      flex-direction: column;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 10px;
      margin-bottom: 15px;
    }

    .message {
      margin-bottom: 15px;
      padding: 12px;
      border-radius: 10px;
      max-width: 80%;
    }

    .message.user {
      background: #667eea;
      color: white;
      margin-left: auto;
      text-align: right;
    }

    .message.ai {
      background: #e9ecef;
      color: #333;
    }

    .message.loading {
      background: #fff3cd;
      color: #856404;
    }

    .message.error {
      background: #f8d7da;
      color: #721c24;
    }

    .chat-input-area {
      display: flex;
      gap: 10px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #667eea;
      font-weight: bold;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .success-message {
      background: #28a745;
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
      display: none;
    }

    @media (max-width: 768px) {
      .main-grid {
        grid-template-columns: 1fr;
      }

      h1 {
        font-size: 1.8em;
      }

      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }

      .form-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>üöó AutoPe√ßas Pro</h1>
      <p class="subtitle">Pe√ßas de qualidade para carros e caminh√µes | Atendimento com IA</p>
    </header>

    <div class="main-grid">
      <div class="card">
        <h2>üì¶ Cat√°logo de Pe√ßas</h2>

        <div class="search-box">
          <select id="vehicleType" name="vehicleType" aria-label="Selecione o tipo de ve√≠culo">
            <option value="">Tipo de Ve√≠culo</option>
            <option value="carro">Carro</option>
            <option value="caminhao">Caminh√£o</option>
          </select>
          <select id="category" name="category" aria-label="Selecione a categoria da pe√ßa">
            <option value="">Categoria</option>
            <option value="motor">Motor</option>
            <option value="freios">Freios</option>
            <option value="suspensao">Suspens√£o</option>
            <option value="eletrica">El√©trica</option>
          </select>
          <button type="button" onclick="filterProducts()">Buscar</button>
        </div>

        <div id="productsContainer" class="products-grid"></div>
      </div>

      <div class="card">
        <h2>ü§ñ Assistente Virtual</h2>
        <div class="chat-container">
          <div id="chatMessages" class="chat-messages">
            <div class="message ai">
              Ol√°! Sou seu assistente virtual. Como posso ajud√°-lo a encontrar a pe√ßa perfeita para seu ve√≠culo? üöó
            </div>
          </div>
          <div class="chat-input-area">
            <input type="text" id="chatInput" placeholder="Digite sua pergunta...">
            <button id="sendBtn" type="button" onclick="sendMessage()">Enviar</button>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>üìã Solicitar Or√ßamento</h2>
      <form id="quoteForm" onsubmit="submitQuote(event)">
        <div class="form-grid">
          <div class="form-group">
            <label for="name">Nome Completo:</label>
            <input type="text" id="name" name="name" required>
          </div>
          <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>
          </div>
          <div class="form-group">
            <label for="phone">Telefone:</label>
            <input type="tel" id="phone" name="phone" required>
          </div>
          <div class="form-group">
            <label for="vehicle">Ve√≠culo (Marca/Modelo/Ano):</label>
            <input type="text" id="vehicle" name="vehicle" placeholder="Ex: Toyota Hilux 2020" required>
          </div>
        </div>
        <div class="form-group">
          <label for="parts">Pe√ßas Necess√°rias:</label>
          <textarea id="parts" name="parts" rows="3" placeholder="Descreva as pe√ßas que voc√™ precisa..."
            required></textarea>
        </div>
        <button type="submit">Enviar Solicita√ß√£o</button>
        <div id="successMessage" class="success-message">
          ‚úÖ Or√ßamento enviado com sucesso! Entraremos em contato em breve.
        </div>
      </form>
    </div>
  </div>

  <script>
    const database = {
      products: [
        { id: 1, name: "Pastilha de Freio Dianteira", category: "freios", type: "carro", price: 89.9, stock: 15 },
        { id: 2, name: "Disco de Freio Ventilado", category: "freios", type: "carro", price: 159.9, stock: 8 },
        { id: 3, name: "Amortecedor Traseiro", category: "suspensao", type: "carro", price: 249.9, stock: 12 },
        { id: 4, name: "Bateria 60Ah", category: "eletrica", type: "carro", price: 389.9, stock: 20 },
        { id: 5, name: "Alternador 90A", category: "eletrica", type: "carro", price: 459.9, stock: 6 },
        { id: 6, name: "Filtro de √ìleo Motor", category: "motor", type: "carro", price: 29.9, stock: 50 },
        { id: 7, name: "Vela de Igni√ß√£o (jogo)", category: "motor", type: "carro", price: 79.9, stock: 30 },
        { id: 8, name: "Pastilha Freio Caminh√£o", category: "freios", type: "caminhao", price: 189.9, stock: 10 },
        { id: 9, name: "Disco Freio Caminh√£o", category: "freios", type: "caminhao", price: 359.9, stock: 5 },
        { id: 10, name: "Bateria 150Ah Caminh√£o", category: "eletrica", type: "caminhao", price: 789.9, stock: 8 },
        { id: 11, name: "Filtro Ar Motor Caminh√£o", category: "motor", type: "caminhao", price: 119.9, stock: 15 },
        { id: 12, name: "Amortecedor Cabine", category: "suspensao", type: "caminhao", price: 449.9, stock: 7 }
      ],
      quotes: []
    };

    function displayProducts(products) {
      const container = document.getElementById('productsContainer');

      if (products.length === 0) {
        container.innerHTML = '<p style="text-align:center; color:#666;">Nenhuma pe√ßa encontrada.</p>';
        return;
      }

      container.innerHTML = products
        .map(product => `
                    <div class="product-card">
                        <h3>${product.name}</h3>
                        <div class="price">R$ ${product.price.toFixed(2)}</div>
                        <div class="stock">Em estoque: ${product.stock}</div>
                        <button onclick="addToQuote('${product.name}')" style="margin-top:10px; padding:8px 15px; font-size:0.9em;">
                            Solicitar
                        </button>
                    </div>
                `).join('');
    }

    function filterProducts() {
      const vehicleType = document.getElementById('vehicleType').value;
      const category = document.getElementById('category').value;

      let filtered = database.products;

      if (vehicleType) {
        filtered = filtered.filter(p => p.type === vehicleType);
      }

      if (category) {
        filtered = filtered.filter(p => p.category === category);
      }

      displayProducts(filtered);
    }

    function addToQuote(productName) {
      const partsField = document.getElementById('parts');
      const currentValue = partsField.value;
      partsField.value = currentValue ? `${currentValue}, ${productName}` : productName;
      partsField.focus();
    }

    async function sendMessage() {
      const input = document.getElementById('chatInput');
      const messagesDiv = document.getElementById('chatMessages');
      const sendBtn = document.getElementById('sendBtn');
      const userMessage = input.value.trim();

      if (!userMessage) return;

      sendBtn.disabled = true;
      input.disabled = true;

      messagesDiv.innerHTML += `<div class="message user">${userMessage}</div>`;
      input.value = '';
      messagesDiv.scrollTop = messagesDiv.scrollHeight;

      const loadingId = 'loading-' + Date.now();
      messagesDiv.innerHTML += `<div class="message ai loading" id="${loadingId}">Pensando... ü§î</div>`;
      messagesDiv.scrollTop = messagesDiv.scrollHeight;

      try {
        const response = await fetch('/api/chat', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: userMessage,
            products: database.products.map(p => ({
              name: p.name,
              price: p.price,
              type: p.type
            }))
          })
        });

        if (!response.ok) {
          throw new Error('Erro na comunica√ß√£o com o servidor');
        }

        const data = await response.json();
        const aiResponse = data.content[0].text;

        document.getElementById(loadingId)?.remove();

        messagesDiv.innerHTML += `<div class="message ai">${aiResponse}</div>`;

      } catch (error) {
        console.error('Erro:', error);

        document.getElementById(loadingId)?.remove();

        messagesDiv.innerHTML += `
                    <div class="message ai error">
                        ‚ùå Erro ao processar mensagem. Verifique se o servidor est√° funcionando.
                    </div>
                `;
      } finally {
        sendBtn.disabled = false;
        input.disabled = false;
        input.focus();
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }
    }

    document.getElementById('chatInput').addEventListener('keypress', function (e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    function submitQuote(event) {
      event.preventDefault();

      const quoteData = {
        id: Date.now(),
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        vehicle: document.getElementById('vehicle').value,
        parts: document.getElementById('parts').value,
        date: new Date().toISOString()
      };

      database.quotes.push(quoteData);

      document.getElementById('successMessage').style.display = 'block';
      document.getElementById('quoteForm').reset();

      setTimeout(() => {
        document.getElementById('successMessage').style.display = 'none';
      }, 5000);

      console.log('Or√ßamentos salvos:', database.quotes);
    }

    displayProducts(database.products);
  </script>
</body>

</html>